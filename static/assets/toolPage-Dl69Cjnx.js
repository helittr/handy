import{l as J,r as g,g as $,d as R,m as G,o as O,i as n,p as v,f as d,w as c,c as S,h as u,q as E,F as M,j as P,s as A,e as K,v as L,x as w,E as Q,t as B,_ as T,b as W,y as q,u as I,a as z,z as D,A as X,K as Y,B as Z}from"./index-VltHhS_7.js";import{c as ee,s as N,e as te,u as oe}from"./taskStore-Dso7qO4y.js";const F=J("commands",()=>{const V=g([]),b=new Map,m=g(null),i=g(null),k=$(()=>{const s=Array.from(b.keys());if(s.length)return b.get(s[0])});function l(){function s(t){for(const e of t.children)b.set(e.id,e),e.type=="scriptgroup"&&s(e)}V.value.forEach(t=>{s(t)})}async function _(){const s=await ee();console.log("Fetched command tree:",s),V.value=s,V.value.length>0&&(l(),console.log("Setting current command to first command in tree"))}function p(s){return b.get(s)}function a(s){const t=[];function e(o){return!!o.find(h=>{if(h.type=="scriptgroup"){if(t.push(h.label),e(h.children))return!0;t.pop()}else if(h.id==s)return t.push(h.label),!0;return!1})}return e(V.value),console.log("command path ",t),t}return{getCommand:p,commandTree:V,currentCommand:m,updateCommandTree:_,currentSn:i,firstCommand:k,getCommandPath:a}}),ne=R({__name:"paramForm",props:{params:{}},emits:["execute"],setup(V,{emit:b}){const m=V,i=b,k=g(),l=G({}),_=G({});function p(){var a;(a=k.value)==null||a.validate(s=>{s?i("execute",l):console.log("error submit!!")})}return O(()=>{console.log("params:",m.params),m.params!==void 0&&m.params.forEach(a=>{l[a.name]=a.default,console.log(`Initialized param ${a.name} with default value:`,a.default),a!=null&&a.required&&(_[a.name]={required:!0,message:`请输入${a.label}`,trigger:"blur"})})}),(a,s)=>{const t=n("el-input"),e=n("el-option"),o=n("el-select"),y=n("el-switch"),h=n("el-form-item"),C=n("el-button"),x=n("el-form");return d(),v(x,{"label-width":"auto","label-position":"left",class:"form",model:l,rules:_,ref_key:"formRef",ref:k,"status-icon":""},{default:c(()=>[(d(!0),S(M,null,E(m.params,r=>(d(),v(h,{key:r.name,label:r.label,prop:r.name},{default:c(()=>[r.type==="input"?(d(),v(t,{key:0,modelValue:l[r.name],"onUpdate:modelValue":f=>l[r.name]=f},null,8,["modelValue","onUpdate:modelValue"])):r.type==="select"?(d(),v(o,{key:1,modelValue:l[r.name],"onUpdate:modelValue":f=>l[r.name]=f},{default:c(()=>[(d(!0),S(M,null,E(r.options,f=>(d(),v(e,{key:f.label,label:f.label,value:f.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):r.type==="switch"?(d(),v(y,{key:2,modelValue:l[r.name],"onUpdate:modelValue":f=>l[r.name]=f},null,8,["modelValue","onUpdate:modelValue"])):A("",!0)]),_:2},1032,["label","prop"]))),128)),u(C,{type:"primary",onClick:p},{default:c(()=>s[0]||(s[0]=[P("执行")])),_:1,__:[0]})]),_:1},8,["model","rules"])}}}),le=R({__name:"scriptDialog",setup(V,{expose:b}){const m=F(),i=K(),k=g(N.PRE),l=g([]),_=g(!1),p=g(null);async function a(t){if(!p.value)return;const e=await te(p.value.id,t);e.code==0&&(i.push("/sm/task/"+e.data.taskId),Q({message:`任务 ${e.data.taskId} 已创建`,type:"success",plain:!0})),k.value=N.RUNNING,_.value=!1}return b({showDialog:t=>{_.value=!0,l.value=m.getCommandPath(t),p.value=m.getCommand(t)||null}}),(t,e)=>{const o=n("el-breadcrumb-item"),y=n("el-breadcrumb"),h=n("el-divider"),C=n("el-dialog"),x=L("loading");return d(),v(C,{modelValue:_.value,"onUpdate:modelValue":e[0]||(e[0]=r=>_.value=r),draggable:""},{default:c(()=>[w((d(),v(y,{separator:"/",class:"breadcrumb"},{default:c(()=>[(d(!0),S(M,null,E(l.value,(r,f)=>(d(),v(o,{key:f},{default:c(()=>[P(B(r),1)]),_:2},1024))),128))]),_:1})),[[x,l.value.length==0]]),u(h),p.value?(d(),v(ne,{key:0,params:p.value.parameters,onExecute:a},null,8,["params"])):A("",!0)]),_:1},8,["modelValue"])}}}),ae=T(le,[["__scopeId","data-v-f4ceb62c"]]),se=["onMouseenter"],ce=R({__name:"toolTree",setup(V){const b=g(null),m=g(0),i=g(""),k=g(0),l=W(),_=F(),p=g(),a=(e,o)=>e?o.label.includes(e):!0;q(i,e=>{p.value.filter(e)}),q(m,(e,o)=>{const y=p.value.getNode(e);console.log("Current node id changed:",y),y.isLeaf||(m.value=o)});const s=e=>l.params.id==(e==null?void 0:e.id)?"currentCommand":"",t=(e,o)=>{console.log("Node clicked:",o),o.isLeaf&&(b.value.showDialog(o.data.id),_.currentCommand=o.data)};return(e,o)=>{const y=n("el-input"),h=n("el-header"),C=n("el-button"),x=n("el-tree"),r=n("el-main"),f=n("el-container"),j=L("loading");return d(),v(f,{class:"container"},{default:c(()=>[u(h,{class:"header"},{default:c(()=>[u(y,{modelValue:i.value,"onUpdate:modelValue":o[0]||(o[0]=U=>i.value=U),placeholder:"Please Input","prefix-icon":"Filter"},null,8,["modelValue"])]),_:1}),u(r,{class:"main"},{default:c(()=>[w((d(),v(x,{ref_key:"treeRef",ref:p,data:I(_).commandTree,"node-key":"id","default-expand-all":"",props:{label:"label",class:s},"filter-node-method":a,"current-node-key":m.value,onNodeClick:t},{default:c(({node:U})=>[z("div",{class:"treeContent",onMouseenter:H=>k.value=U.id,onMouseleave:o[1]||(o[1]=H=>k.value=0)},[z("span",null,B(U.label),1),w(u(C,{class:"btn",size:"small",icon:"VideoPlay",circle:""},null,512),[[D,!1]])],40,se)]),_:1},8,["data","props","current-node-key"])),[[j,I(_).commandTree.length==0]])]),_:1}),u(ae,{ref_key:"scriptDialogRef",ref:b},null,512)]),_:1})}}}),re=T(ce,[["__scopeId","data-v-956b6ff1"]]),ue=R({__name:"taskList",setup(V){const b=F(),m=K(),i=oe(),k=$(()=>i.tasks.filter(t=>t.status==N.RUNNING)),l=$(()=>i.tasks.filter(t=>t.status!=N.RUNNING)),_=g([{label:"已完成",children:l},{label:"运行中",children:k}]);function p(t){var e;return"children"in t?t.label:((e=b.getCommand(t.commandId))==null?void 0:e.label)+"-"+t.taskId}function a(){i.updateTasks(),setTimeout(()=>{a()},1e3)}function s(t){"children"in t||m.push("/sm/task/"+t.taskId)}return X(a),(t,e)=>{const o=n("el-text"),y=n("Loading"),h=n("el-icon"),C=n("Finished"),x=n("el-tree"),r=L("loading");return d(),S("div",null,[w((d(),v(x,{data:_.value,"expand-on-click-node":!1,props:{label:p},onNodeClick:s,"default-expand-all":"",indent:2},{default:c(({node:f})=>[u(o,{truncated:""},{default:c(()=>[P(B(f.label),1)]),_:2},1024),w(u(h,{class:"is-loading icon",color:"#409EFF"},{default:c(()=>[u(y)]),_:2},1536),[[D,f.data.status==I(N).RUNNING]]),w(u(h,{class:"icon",color:"green"},{default:c(()=>[u(C)]),_:2},1536),[[D,f.data.status==I(N).FINISH]])]),_:1},8,["data","props"])),[[r,I(i).tasks.length==0]])])}}}),de=T(ue,[["__scopeId","data-v-ec4c9fde"]]),ie=R({__name:"toolPage",setup(V){const b=F(),m=g(["1","2"]),i=g(null);return b.updateCommandTree(),(k,l)=>{const _=n("el-collapse-item"),p=n("el-collapse"),a=n("el-aside"),s=n("RouterView"),t=n("el-main"),e=n("el-container");return d(),v(e,null,{default:c(()=>[u(a,{class:"aside",width:"200px"},{default:c(()=>[u(p,{class:"collapse","expand-icon-position":"left",modelValue:m.value,"onUpdate:modelValue":l[2]||(l[2]=o=>m.value=o)},{default:c(()=>[u(_,{title:"任务列表",name:"1"},{default:c(()=>[u(de,{modelValue:i.value,"onUpdate:modelValue":l[0]||(l[0]=o=>i.value=o)},null,8,["modelValue"])]),_:1}),u(_,{title:"脚本列表",name:"2"},{default:c(()=>[u(re,{modelValue:i.value,"onUpdate:modelValue":l[1]||(l[1]=o=>i.value=o)},null,8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])]),_:1}),u(e,{class:"mainContainer"},{default:c(()=>[u(t,{class:"main"},{default:c(()=>[u(s,null,{default:c(({Component:o})=>[(d(),v(Y,null,[(d(),v(Z(o),{key:k.$route.path}))],1024))]),_:1})]),_:1})]),_:1})]),_:1})}}}),pe=T(ie,[["__scopeId","data-v-44bcf215"]]);export{pe as default};
