import{g as $,a as E,s as k,u as S,d as F,b as M}from"./taskStore-Dso7qO4y.js";import{d as b,r as T,o as B,c as N,a as _,t as p,u as x,b as C,e as w,f as D,n as G,_ as L,g as U,h as n,w as u,i as v,F as V,j as f,E as I}from"./index-VltHhS_7.js";const H={class:"terminal-container"},j={class:"terminal-header"},z={class:"terminal-title"},A=b({__name:"logTerm",setup(R,{expose:h}){const m=C(),i=w(),g=T(""),e=T(0),d=T(null),y=(c,a)=>{g.value+=a,e.value+=c,G(()=>{d.value&&(d.value.scrollTop=d.value.scrollHeight)})},r=new TextDecoder("gb2312"),l=()=>{o(),s()},o=()=>{g.value="",e.value=0};async function s(){const c=parseInt(m.params.id);if(isNaN(c))i.push("/sm");else try{const a=await $(c,e.value,1024e3);a.byteLength&&y(a.byteLength,r.decode(a,{stream:!0}));const t=await E(c);console.log("st",t,"length",a.byteLength),(t.status==k.FINISH||t.status==k.TERMINATED)&&a.byteLength==0||setTimeout(s,500)}catch(a){console.log("error",a)}}return B(()=>{s()}),h({clearLogs:o}),(c,a)=>(D(),N("div",H,[_("div",j,[_("div",z,p(x(m).params.id),1),_("div",{class:"terminal-controls"},[_("button",{onClick:l},"刷新")])]),_("div",{ref_key:"logContainer",ref:d,class:"terminal-body"},p(g.value),513)]))}}),P=L(A,[["__scopeId","data-v-ddfd898b"]]),q={class:"logContainer"},J=b({__name:"taskDtail",setup(R){const h=C(),m=w(),i=S(),g=T(null),e=U(()=>i.taskMap.get(parseInt(h.params.id))),d=async()=>{var r,l,o,s;if(((r=e.value)==null?void 0:r.status)==k.RUNNING){I({message:`任务(${(l=e.value)==null?void 0:l.taskId})正在运行，无法删除`,type:"error",plain:!0});return}await F((o=e.value)==null?void 0:o.taskId)&&(I({message:`任务(${(s=e.value)==null?void 0:s.taskId})删除成功`,type:"success",plain:!0}),await i.updateTasks(),i.tasks.length>0?m.push("/sm/task/"+i.tasks[0].taskId):m.push("/sm"))},y=async()=>{var r,l,o,s;((r=e.value)==null?void 0:r.status)!=k.RUNNING?I({message:`任务(${(l=e.value)==null?void 0:l.taskId})未运行，无法停止`,type:"error",plain:!0}):(await M((o=e.value)==null?void 0:o.taskId),I({message:`任务(${(s=e.value)==null?void 0:s.taskId})已停止`,type:"success",plain:!0}),await i.updateTasks())};return(r,l)=>{const o=v("el-button"),s=v("el-descriptions-item"),c=v("el-tag"),a=v("el-descriptions");return D(),N(V,null,[n(a,{title:"任务详情"},{extra:u(()=>[n(o,{type:"danger",icon:"DeleteFilled",onClick:d}),n(o,{type:"primary",onClick:y},{default:u(()=>l[0]||(l[0]=[f("停止")])),_:1,__:[0]})]),default:u(()=>[n(s,{label:"任务 ID:"},{default:u(()=>{var t;return[f(p((t=e.value)==null?void 0:t.taskId),1)]}),_:1}),n(s,{label:"状态:"},{default:u(()=>[n(c,{size:"small"},{default:u(()=>{var t;return[f(p(((t=e.value)==null?void 0:t.status)==x(k).RUNNING?"运行中":"已完成"),1)]}),_:1})]),_:1}),n(s,{label:"脚本 ID:"},{default:u(()=>{var t;return[f(p((t=e.value)==null?void 0:t.commandId),1)]}),_:1}),n(s,{label:"cmdline:"},{default:u(()=>{var t;return[f(p((t=e.value)==null?void 0:t.cmdline),1)]}),_:1})]),_:1}),_("div",q,[n(P,{ref_key:"logTermRef",ref:g},null,512)])],64)}}}),Q=L(J,[["__scopeId","data-v-d5871bef"]]);export{Q as default};
