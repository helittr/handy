import{l as J,r as v,g as $,d as R,m as G,o as O,i as n,p as f,f as d,w as r,c as U,h as u,q as E,F as M,j as P,s as A,e as K,v as L,x as w,E as Q,t as B,_ as T,b as W,y as q,u as I,a as z,z as D,A as X,K as Y,B as Z}from"./index-KtPmtG2Z.js";import{c as ee,s as N,e as te,u as oe}from"./taskStore-D1EvZgtu.js";const F=J("commands",()=>{const y=v([]),g=new Map,m=v(null),i=v(null),b=$(()=>{const e=Array.from(g.keys());if(e.length)return g.get(e[0])});function l(){function e(a){for(const t of a.children)g.set(t.id,t),t.type=="scriptgroup"&&e(t)}y.value.forEach(a=>{e(a)})}async function _(){const e=await ee();console.log("Fetched command tree:",e),y.value=e,y.value.length>0&&(l(),console.log("Setting current command to first command in tree"))}function p(e){return g.get(e)}function s(e){const a=[];function t(o){return!!o.find(h=>{if(h.type=="scriptgroup"){if(a.push(h.label),t(h.children))return!0;a.pop()}else if(h.id==e)return a.push(h.label),!0;return!1})}return t(y.value),console.log("command path ",a),a}return{getCommand:p,commandTree:y,currentCommand:m,updateCommandTree:_,currentSn:i,firstCommand:b,getCommandPath:s}}),ne=R({__name:"paramForm",props:{params:{}},emits:["execute"],setup(y,{emit:g}){const m=y,i=g,b=v(),l=G({}),_=G({});function p(){var s;(s=b.value)==null||s.validate(e=>{e?i("execute",l):console.log("error submit!!")})}return O(()=>{console.log("params:",m.params),m.params!==void 0&&m.params.forEach(s=>{l[s.name]=s.default,console.log(`Initialized param ${s.name} with default value:`,s.default),s!=null&&s.required&&(_[s.name]={required:!0,message:`请输入${s.label}`,trigger:"blur"})})}),(s,e)=>{const a=n("el-input"),t=n("el-option"),o=n("el-select"),V=n("el-switch"),h=n("el-form-item"),C=n("el-button"),x=n("el-form");return d(),f(x,{"label-width":"auto","label-position":"left",class:"form",model:l,rules:_,ref_key:"formRef",ref:b,"status-icon":""},{default:r(()=>[(d(!0),U(M,null,E(m.params,c=>(d(),f(h,{key:c.name,label:c.label,prop:c.name},{default:r(()=>[c.type==="input"?(d(),f(a,{key:0,modelValue:l[c.name],"onUpdate:modelValue":k=>l[c.name]=k},null,8,["modelValue","onUpdate:modelValue"])):c.type==="select"?(d(),f(o,{key:1,modelValue:l[c.name],"onUpdate:modelValue":k=>l[c.name]=k},{default:r(()=>[(d(!0),U(M,null,E(c.options,k=>(d(),f(t,{key:k.label,label:k.label,value:k.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):c.type==="switch"?(d(),f(V,{key:2,modelValue:l[c.name],"onUpdate:modelValue":k=>l[c.name]=k},null,8,["modelValue","onUpdate:modelValue"])):A("",!0)]),_:2},1032,["label","prop"]))),128)),u(C,{type:"primary",onClick:p},{default:r(()=>e[0]||(e[0]=[P("执行")])),_:1,__:[0]})]),_:1},8,["model","rules"])}}}),le=R({__name:"scriptDialog",setup(y,{expose:g}){const m=F(),i=K(),b=v(N.PRE),l=v([]),_=v(!1),p=v(null);async function s(a){if(!p.value)return;const t=await te(p.value.id,a);t.code==0&&(i.push("/sm/task/"+t.data.taskId),Q({message:`任务 ${t.data.taskId} 已创建`,type:"success",plain:!0})),b.value=N.RUNNING,_.value=!1}return g({showDialog:a=>{_.value=!0,l.value=m.getCommandPath(a),p.value=m.getCommand(a)||null}}),(a,t)=>{const o=n("el-breadcrumb-item"),V=n("el-breadcrumb"),h=n("el-divider"),C=n("el-dialog"),x=L("loading");return d(),f(C,{modelValue:_.value,"onUpdate:modelValue":t[0]||(t[0]=c=>_.value=c),draggable:""},{default:r(()=>[w((d(),f(V,{separator:"/",class:"breadcrumb"},{default:r(()=>[(d(!0),U(M,null,E(l.value,(c,k)=>(d(),f(o,{key:k},{default:r(()=>[P(B(c),1)]),_:2},1024))),128))]),_:1})),[[x,l.value.length==0]]),u(h),p.value?(d(),f(ne,{key:0,params:p.value.parameters,onExecute:s},null,8,["params"])):A("",!0)]),_:1},8,["modelValue"])}}}),ae=T(le,[["__scopeId","data-v-f4ceb62c"]]),se=["onMouseenter"],ce=R({__name:"toolTree",setup(y){const g=v(null),m=v(0),i=v(""),b=v(0),l=W(),_=F(),p=v(),s=(t,o)=>t?o.label.includes(t):!0;q(i,t=>{p.value.filter(t)}),q(m,(t,o)=>{const V=p.value.getNode(t);console.log("Current node id changed:",V),V.isLeaf||(m.value=o)});const e=t=>l.params.id==(t==null?void 0:t.id)?"currentCommand":"",a=(t,o)=>{console.log("Node clicked:",o),o.isLeaf&&(g.value.showDialog(o.data.id),_.currentCommand=o.data)};return(t,o)=>{const V=n("el-input"),h=n("el-header"),C=n("el-button"),x=n("el-tree"),c=n("el-main"),k=n("el-container"),j=L("loading");return d(),f(k,{class:"container"},{default:r(()=>[u(h,{class:"header"},{default:r(()=>[u(V,{modelValue:i.value,"onUpdate:modelValue":o[0]||(o[0]=S=>i.value=S),placeholder:"Please Input","prefix-icon":"Filter"},null,8,["modelValue"])]),_:1}),u(c,{class:"main"},{default:r(()=>[w((d(),f(x,{ref_key:"treeRef",ref:p,data:I(_).commandTree,"node-key":"id","default-expand-all":"",props:{label:"label",class:e},"filter-node-method":s,"current-node-key":m.value,onNodeClick:a},{default:r(({node:S})=>[z("div",{class:"treeContent",onMouseenter:H=>b.value=S.id,onMouseleave:o[1]||(o[1]=H=>b.value=0)},[z("span",null,B(S.label),1),w(u(C,{class:"btn",size:"small",icon:"VideoPlay",circle:""},null,512),[[D,!1]])],40,se)]),_:1},8,["data","props","current-node-key"])),[[j,I(_).commandTree.length==0]])]),_:1}),u(ae,{ref_key:"scriptDialogRef",ref:g},null,512)]),_:1})}}}),re=T(ce,[["__scopeId","data-v-956b6ff1"]]),ue=R({__name:"taskList",setup(y){const g=F(),m=K(),i=oe(),b=$(()=>i.tasks.filter(e=>e.status==N.RUNNING)),l=$(()=>i.tasks.filter(e=>e.status!=N.RUNNING)),_=v([{label:"已完成",children:l},{label:"运行中",children:b}]);function p(e){var a;return"children"in e?e.label:((a=g.getCommand(e.commandId))==null?void 0:a.label)+"-"+e.taskId}function s(e){"children"in e||m.push("/sm/task/"+e.taskId)}return X(async()=>{i.startSync()}),(e,a)=>{const t=n("el-text"),o=n("Loading"),V=n("el-icon"),h=n("Finished"),C=n("el-tree"),x=L("loading");return d(),U("div",null,[w((d(),f(C,{data:_.value,"expand-on-click-node":!1,props:{label:p},onNodeClick:s,"default-expand-all":"",indent:2},{default:r(({node:c})=>[u(t,{truncated:""},{default:r(()=>[P(B(c.label),1)]),_:2},1024),w(u(V,{class:"is-loading icon",color:"#409EFF"},{default:r(()=>[u(o)]),_:2},1536),[[D,c.data.status==I(N).RUNNING]]),w(u(V,{class:"icon",color:"green"},{default:r(()=>[u(h)]),_:2},1536),[[D,c.data.status==I(N).FINISH]])]),_:1},8,["data","props"])),[[x,I(i).tasks.length==0]])])}}}),de=T(ue,[["__scopeId","data-v-69f57e1f"]]),ie=R({__name:"toolPage",setup(y){const g=F(),m=v(["1","2"]),i=v(null);return g.updateCommandTree(),(b,l)=>{const _=n("el-collapse-item"),p=n("el-collapse"),s=n("el-aside"),e=n("RouterView"),a=n("el-main"),t=n("el-container");return d(),f(t,null,{default:r(()=>[u(s,{class:"aside",width:"200px"},{default:r(()=>[u(p,{class:"collapse","expand-icon-position":"left",modelValue:m.value,"onUpdate:modelValue":l[2]||(l[2]=o=>m.value=o)},{default:r(()=>[u(_,{title:"任务列表",name:"1"},{default:r(()=>[u(de,{modelValue:i.value,"onUpdate:modelValue":l[0]||(l[0]=o=>i.value=o)},null,8,["modelValue"])]),_:1}),u(_,{title:"脚本列表",name:"2"},{default:r(()=>[u(re,{modelValue:i.value,"onUpdate:modelValue":l[1]||(l[1]=o=>i.value=o)},null,8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])]),_:1}),u(t,{class:"mainContainer"},{default:r(()=>[u(a,{class:"main"},{default:r(()=>[u(e,null,{default:r(({Component:o})=>[(d(),f(Y,null,[(d(),f(Z(o),{key:b.$route.path}))],1024))]),_:1})]),_:1})]),_:1})]),_:1})}}}),pe=T(ie,[["__scopeId","data-v-44bcf215"]]);export{pe as default};
