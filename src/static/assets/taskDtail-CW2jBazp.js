import{g as $,a as E,s as k,u as S,d as F,b as M}from"./taskStore-BkPqD6VD.js";import{d as b,r as h,o as B,c as N,a as d,t as _,u as x,b as C,e as D,f as L,n as G,_ as R,g as U,h as n,w as u,i as v,F as V,j as f,E as I}from"./index-BnLg6p_O.js";const H={class:"terminal-container"},j={class:"terminal-header"},z={class:"terminal-title"},A=b({__name:"logTerm",setup(w,{expose:y}){const p=C(),m=D(),g=h(""),e=h(0),i=h(null),T=(c,a)=>{g.value+=a,e.value+=c,G(()=>{i.value&&(i.value.scrollTop=i.value.scrollHeight)})},r=new TextDecoder("gb2312"),l=()=>{o(),s()},o=()=>{g.value="",e.value=0};async function s(){const c=parseInt(p.params.id);if(isNaN(c))m.push("/sm");else try{const a=await $(c,e.value,1024e3);a.byteLength&&T(a.byteLength,r.decode(a,{stream:!0}));const t=await E(c);console.log("st",t,"length",a.byteLength),(t.status==k.FINISH||t.status==k.TERMINATED)&&a.byteLength==0||setTimeout(s,500)}catch(a){console.log("error",a)}}return B(()=>{s()}),y({clearLogs:o}),(c,a)=>(L(),N("div",H,[d("div",j,[d("div",z,_(x(p).params.id),1),d("div",{class:"terminal-controls"},[d("button",{onClick:l},"刷新")])]),d("div",{ref_key:"logContainer",ref:i,class:"terminal-body"},_(g.value),513)]))}}),P=R(A,[["__scopeId","data-v-ddfd898b"]]),q={class:"logContainer"},J=b({__name:"taskDtail",setup(w){const y=C(),p=D(),m=S(),g=h(null),e=U(()=>m.taskMap.get(parseInt(y.params.id))),i=async()=>{var r,l,o,s;if(((r=e.value)==null?void 0:r.status)==k.RUNNING){I({message:`任务(${(l=e.value)==null?void 0:l.taskId})正在运行，无法删除`,type:"error",plain:!0});return}await F((o=e.value)==null?void 0:o.taskId)&&(I({message:`任务(${(s=e.value)==null?void 0:s.taskId})删除成功`,type:"success",plain:!0}),m.tasks.length>0?p.push("/sm/task/"+m.tasks[0].taskId):p.push("/sm"))},T=async()=>{var r,l,o,s;((r=e.value)==null?void 0:r.status)!=k.RUNNING?I({message:`任务(${(l=e.value)==null?void 0:l.taskId})未运行，无法停止`,type:"error",plain:!0}):(await M((o=e.value)==null?void 0:o.taskId),I({message:`任务(${(s=e.value)==null?void 0:s.taskId})已停止`,type:"success",plain:!0}))};return(r,l)=>{const o=v("el-button"),s=v("el-descriptions-item"),c=v("el-tag"),a=v("el-descriptions");return L(),N(V,null,[n(a,{title:"任务详情"},{extra:u(()=>[n(o,{type:"danger",icon:"DeleteFilled",onClick:i}),n(o,{type:"primary",onClick:T},{default:u(()=>l[0]||(l[0]=[f("停止")])),_:1,__:[0]})]),default:u(()=>[n(s,{label:"任务 ID:"},{default:u(()=>{var t;return[f(_((t=e.value)==null?void 0:t.taskId),1)]}),_:1}),n(s,{label:"状态:"},{default:u(()=>[n(c,{size:"small"},{default:u(()=>{var t;return[f(_(((t=e.value)==null?void 0:t.status)==x(k).RUNNING?"运行中":"已完成"),1)]}),_:1})]),_:1}),n(s,{label:"脚本 ID:"},{default:u(()=>{var t;return[f(_((t=e.value)==null?void 0:t.commandId),1)]}),_:1}),n(s,{label:"cmdline:"},{default:u(()=>{var t;return[f(_((t=e.value)==null?void 0:t.cmdline),1)]}),_:1})]),_:1}),d("div",q,[n(P,{ref_key:"logTermRef",ref:g},null,512)])],64)}}}),Q=R(J,[["__scopeId","data-v-d099eb71"]]);export{Q as default};
