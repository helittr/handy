import{l as J,r as g,g as D,d as R,m as q,o as O,i as n,p as v,f as i,w as s,c as U,h as r,q as P,F as L,j as T,s as K,e as j,v as G,x as w,t as F,E as Q,_ as $,b as W,y as z,u as I,a as A,z as B,A as X,K as Y,B as Z}from"./index-BnLg6p_O.js";import{c as ee,s as N,e as te,u as oe}from"./taskStore-BkPqD6VD.js";const E=J("commands",()=>{const V=g([]),b=new Map,m=g(null),d=g(null),k=D(()=>{const e=Array.from(b.keys());if(e.length)return b.get(e[0])});function l(){function e(a){for(const t of a.children)b.set(t.id,t),t.type=="scriptgroup"&&e(t)}V.value.forEach(a=>{e(a)})}async function _(){const e=await ee();console.log("Fetched command tree:",e),V.value=e,V.value.length>0&&(l(),console.log("Setting current command to first command in tree"))}function p(e){return b.get(e)}function c(e){const a=[];function t(o){return!!o.find(h=>{if(h.type=="scriptgroup"){if(a.push(h.label),t(h.children))return!0;a.pop()}else if(h.id==e)return a.push(h.label),!0;return!1})}return t(V.value),console.log("command path ",a),a}return{getCommand:p,commandTree:V,currentCommand:m,updateCommandTree:_,currentSn:d,firstCommand:k,getCommandPath:c}}),ne=R({__name:"paramForm",props:{params:{}},emits:["execute"],setup(V,{emit:b}){const m=V,d=b,k=g(),l=q({}),_=q({});function p(){var c;(c=k.value)==null||c.validate(e=>{e?d("execute",l):console.log("error submit!!")})}return O(()=>{console.log("params:",m.params),m.params!==void 0&&m.params.forEach(c=>{l[c.name]=c.default,console.log(`Initialized param ${c.name} with default value:`,c.default),c!=null&&c.required&&(_[c.name]={required:!0,message:`请输入${c.label}`,trigger:"blur"})})}),(c,e)=>{const a=n("el-input"),t=n("el-option"),o=n("el-select"),y=n("el-switch"),h=n("el-form-item"),C=n("el-button"),x=n("el-form");return i(),v(x,{"label-width":"auto","label-position":"left",class:"form",model:l,rules:_,ref_key:"formRef",ref:k,"status-icon":""},{default:s(()=>[(i(!0),U(L,null,P(m.params,u=>(i(),v(h,{key:u.name,label:u.label,prop:u.name},{default:s(()=>[u.type==="input"?(i(),v(a,{key:0,modelValue:l[u.name],"onUpdate:modelValue":f=>l[u.name]=f},null,8,["modelValue","onUpdate:modelValue"])):u.type==="select"?(i(),v(o,{key:1,modelValue:l[u.name],"onUpdate:modelValue":f=>l[u.name]=f},{default:s(()=>[(i(!0),U(L,null,P(u.options,f=>(i(),v(t,{key:f.label,label:f.label,value:f.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):u.type==="switch"?(i(),v(y,{key:2,modelValue:l[u.name],"onUpdate:modelValue":f=>l[u.name]=f},null,8,["modelValue","onUpdate:modelValue"])):K("",!0)]),_:2},1032,["label","prop"]))),128)),r(C,{type:"primary",onClick:p},{default:s(()=>e[0]||(e[0]=[T("执行")])),_:1,__:[0]})]),_:1},8,["model","rules"])}}}),le=R({__name:"scriptDialog",setup(V,{expose:b}){const m=E(),d=j(),k=g(N.PRE),l=g([]),_=g(!1),p=g(null);async function c(a){if(!p.value)return;const t=await te(p.value.id,a);t.code==0&&(d.push("/sm/task/"+t.data.taskId),Q({message:`任务 ${t.data.taskId} 已创建`,type:"success",plain:!0})),k.value=N.RUNNING,_.value=!1}return b({showDialog:a=>{_.value=!0,l.value=m.getCommandPath(a),p.value=m.getCommand(a)||null}}),(a,t)=>{const o=n("el-breadcrumb-item"),y=n("el-breadcrumb"),h=n("el-divider"),C=n("el-text"),x=n("el-dialog"),u=G("loading");return i(),v(x,{modelValue:_.value,"onUpdate:modelValue":t[0]||(t[0]=f=>_.value=f),draggable:""},{default:s(()=>[w((i(),v(y,{separator:"/",class:"breadcrumb"},{default:s(()=>[(i(!0),U(L,null,P(l.value,(f,M)=>(i(),v(o,{key:M},{default:s(()=>[T(F(f),1)]),_:2},1024))),128))]),_:1})),[[u,l.value.length==0]]),r(h,{class:"line"}),r(C,{type:"primary","line-clamp":6},{default:s(()=>{var f;return[T(F((f=p.value)==null?void 0:f.description),1)]}),_:1}),r(h,{class:"line","content-position":"left"}),p.value?(i(),v(ne,{key:0,params:p.value.parameters,onExecute:c},null,8,["params"])):K("",!0)]),_:1},8,["modelValue"])}}}),ae=$(le,[["__scopeId","data-v-414608fd"]]),se=["onMouseenter"],ce=R({__name:"toolTree",setup(V){const b=g(null),m=g(0),d=g(""),k=g(0),l=W(),_=E(),p=g(),c=(t,o)=>t?o.label.includes(t):!0;z(d,t=>{p.value.filter(t)}),z(m,(t,o)=>{const y=p.value.getNode(t);console.log("Current node id changed:",y),y.isLeaf||(m.value=o)});const e=t=>l.params.id==(t==null?void 0:t.id)?"currentCommand":"",a=(t,o)=>{console.log("Node clicked:",o),o.isLeaf&&(b.value.showDialog(o.data.id),_.currentCommand=o.data)};return(t,o)=>{const y=n("el-input"),h=n("el-header"),C=n("el-button"),x=n("el-tree"),u=n("el-main"),f=n("el-container"),M=G("loading");return i(),v(f,{class:"container"},{default:s(()=>[r(h,{class:"header"},{default:s(()=>[r(y,{modelValue:d.value,"onUpdate:modelValue":o[0]||(o[0]=S=>d.value=S),placeholder:"Please Input","prefix-icon":"Filter"},null,8,["modelValue"])]),_:1}),r(u,{class:"main"},{default:s(()=>[w((i(),v(x,{ref_key:"treeRef",ref:p,data:I(_).commandTree,"node-key":"id","default-expand-all":"",props:{label:"label",class:e},"filter-node-method":c,"current-node-key":m.value,onNodeClick:a},{default:s(({node:S})=>[A("div",{class:"treeContent",onMouseenter:H=>k.value=S.id,onMouseleave:o[1]||(o[1]=H=>k.value=0)},[A("span",null,F(S.label),1),w(r(C,{class:"btn",size:"small",icon:"VideoPlay",circle:""},null,512),[[B,!1]])],40,se)]),_:1},8,["data","props","current-node-key"])),[[M,I(_).commandTree.length==0]])]),_:1}),r(ae,{ref_key:"scriptDialogRef",ref:b},null,512)]),_:1})}}}),re=$(ce,[["__scopeId","data-v-956b6ff1"]]),ue=R({__name:"taskList",setup(V){const b=E(),m=j(),d=oe(),k=D(()=>d.tasks.filter(e=>e.status==N.RUNNING)),l=D(()=>d.tasks.filter(e=>e.status!=N.RUNNING)),_=g([{label:"已完成",children:l},{label:"运行中",children:k}]);function p(e){var a;return"children"in e?e.label:((a=b.getCommand(e.commandId))==null?void 0:a.label)+"-"+e.taskId}function c(e){"children"in e||m.push("/sm/task/"+e.taskId)}return X(async()=>{d.startSync()}),(e,a)=>{const t=n("el-text"),o=n("Loading"),y=n("el-icon"),h=n("Finished"),C=n("el-tree"),x=G("loading");return i(),U("div",null,[w((i(),v(C,{data:_.value,"expand-on-click-node":!1,props:{label:p},onNodeClick:c,"default-expand-all":"",indent:2},{default:s(({node:u})=>[r(t,{truncated:""},{default:s(()=>[T(F(u.label),1)]),_:2},1024),w(r(y,{class:"is-loading icon",color:"#409EFF"},{default:s(()=>[r(o)]),_:2},1536),[[B,u.data.status==I(N).RUNNING]]),w(r(y,{class:"icon",color:"green"},{default:s(()=>[r(h)]),_:2},1536),[[B,u.data.status==I(N).FINISH]])]),_:1},8,["data","props"])),[[x,I(d).tasks.length==0]])])}}}),ie=$(ue,[["__scopeId","data-v-69f57e1f"]]),de=R({__name:"toolPage",setup(V){const b=E(),m=g(["1","2"]),d=g(null);return b.updateCommandTree(),(k,l)=>{const _=n("el-collapse-item"),p=n("el-collapse"),c=n("el-aside"),e=n("RouterView"),a=n("el-main"),t=n("el-container");return i(),v(t,null,{default:s(()=>[r(c,{class:"aside",width:"200px"},{default:s(()=>[r(p,{class:"collapse","expand-icon-position":"left",modelValue:m.value,"onUpdate:modelValue":l[2]||(l[2]=o=>m.value=o)},{default:s(()=>[r(_,{title:"任务列表",name:"1"},{default:s(()=>[r(ie,{modelValue:d.value,"onUpdate:modelValue":l[0]||(l[0]=o=>d.value=o)},null,8,["modelValue"])]),_:1}),r(_,{title:"脚本列表",name:"2"},{default:s(()=>[r(re,{modelValue:d.value,"onUpdate:modelValue":l[1]||(l[1]=o=>d.value=o)},null,8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])]),_:1}),r(t,{class:"mainContainer"},{default:s(()=>[r(a,{class:"main"},{default:s(()=>[r(e,null,{default:s(({Component:o})=>[(i(),v(Y,null,[(i(),v(Z(o),{key:k.$route.path}))],1024))]),_:1})]),_:1})]),_:1})]),_:1})}}}),pe=$(de,[["__scopeId","data-v-44bcf215"]]);export{pe as default};
